---
title: 共立製薬 スコアシートデータモデル設計
tags: [project/kyoritsu, data-model, technical]
created: 2026-02-11
updated: 2026-02-11
---

# スコアシート データモデル設計

---

## ER図

```
┌─────────────────────────┐
│         study            │
│       （試験）            │
├─────────────────────────┤
│ PK  study_id             │
│     study_name           │
│     study_description    │
│     study_period_start   │
│     study_period_end     │
│     administered_substance│
│     expected_symptoms    │
│     created_at           │
│     updated_at           │
└────────────┬────────────┘
             │ 1
             │
             │ N
┌────────────┴────────────┐
│      score_sheet         │
│  （スコアシート/個体）    │
├─────────────────────────┤
│ PK  score_sheet_id       │
│ FK  study_id             │
│     animal_id            │
│     administered_substance│
│     expected_symptoms    │
│     laboratory_name      │
│     created_at           │
│     updated_at           │
└────────────┬────────────┘
             │ 1
             │
             │ N
┌────────────┴────────────┐
│      observation         │
│     （観察記録）          │
├─────────────────────────┤
│ PK  observation_id       │
│ FK  score_sheet_id       │
│     observed_at          │
│     observer_name        │
│     rectal_temperature   │
│     body_weight          │
│     appetite             │
│     energy               │
│     dehydration          │
│     vomiting             │
│     feces                │
│     nasal_discharge_l    │
│     nasal_discharge_r    │
│     lacrimation_l        │
│     lacrimation_r        │
│     eye_discharge_l      │
│     eye_discharge_r      │
│     conjunctivitis_l     │
│     conjunctivitis_r     │
│     coughing             │
│     sneezing             │
│     respiratory_abnormal │
│     remarks              │
│     created_at           │
│     created_by           │
└─────────────────────────┘
```

### リレーション

```
study 1 ──── N score_sheet 1 ──── N observation

1つの試験に複数の個体（スコアシート）が紐づき、
1つのスコアシートに複数日の観察記録が紐づく。
```

---

## テーブル定義

### 1. study（試験）

試験単位のマスター情報。

| カラム名 | 型 | NULL | 説明 |
|---------|-----|------|------|
| **study_id** | VARCHAR(36) | NOT NULL | PK. UUID |
| study_name | VARCHAR(200) | NOT NULL | 試験名 |
| study_description | TEXT | | 試験概要 |
| study_period_start | DATE | NOT NULL | 試験開始日 |
| study_period_end | DATE | | 試験終了日 |
| administered_substance | VARCHAR(500) | | 投与物質（試験レベル） |
| expected_symptoms | TEXT | | 想定症状（試験レベル） |
| created_at | TIMESTAMP_NTZ | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP_NTZ | NOT NULL | 更新日時 |

### 2. score_sheet（スコアシート / 個体割当）

試験 × 個体の単位。紙のスコアシート1枚に対応する。

| カラム名 | 型 | NULL | 説明 |
|---------|-----|------|------|
| **score_sheet_id** | VARCHAR(36) | NOT NULL | PK. UUID |
| study_id | VARCHAR(36) | NOT NULL | FK → study |
| animal_id | VARCHAR(50) | NOT NULL | 個体番号 |
| administered_substance | VARCHAR(500) | | 投与物質（個体レベル。対照群/投与群で異なる） |
| expected_symptoms | TEXT | | 予想される症状（個体レベル） |
| laboratory_name | VARCHAR(200) | | 実験室名 |
| created_at | TIMESTAMP_NTZ | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP_NTZ | NOT NULL | 更新日時 |

**ユニーク制約**: `(study_id, animal_id)` — 同一試験内で個体番号は一意

### 3. observation（観察記録）

スコアシート1行に対応する。1回の観察（日時）ごとに1レコード。

| カラム名 | 型 | NULL | 説明 | 値域 |
|---------|-----|------|------|------|
| **observation_id** | VARCHAR(36) | NOT NULL | PK. UUID | |
| score_sheet_id | VARCHAR(36) | NOT NULL | FK → score_sheet | |
| observed_at | TIMESTAMP_NTZ | NOT NULL | 観察日時（年月日 + 時間） | |
| observer_name | VARCHAR(100) | NOT NULL | 管理者名 | |
| rectal_temperature | DECIMAL(4,1) | | ①直腸温 [℃] | 35.0〜42.0 |
| body_weight | DECIMAL(5,2) | | 体重 [kg] | 0.01〜 |
| appetite | SMALLINT | | ②食欲 | 0〜3 |
| energy | SMALLINT | | ③元気 | 0〜3 |
| dehydration | SMALLINT | | ④脱水 | 0〜3 |
| vomiting | SMALLINT | | ⑤嘔吐 | 0〜1 |
| feces | SMALLINT | | ⑥糞便 | 0〜4 |
| nasal_discharge_l | SMALLINT | | ⑦鼻汁（左） | 0〜5 |
| nasal_discharge_r | SMALLINT | | ⑦鼻汁（右） | 0〜5 |
| lacrimation_l | SMALLINT | | ⑧流涙（左） | 0〜2 |
| lacrimation_r | SMALLINT | | ⑧流涙（右） | 0〜2 |
| eye_discharge_l | SMALLINT | | ⑨眼脂（左） | 0〜2 |
| eye_discharge_r | SMALLINT | | ⑨眼脂（右） | 0〜2 |
| conjunctivitis_l | SMALLINT | | ⑩結膜炎（左） | 0〜3 |
| conjunctivitis_r | SMALLINT | | ⑩結膜炎（右） | 0〜3 |
| coughing | SMALLINT | | ⑪発咳 | 0〜2 |
| sneezing | SMALLINT | | ⑫くしゃみ | 0〜2 |
| respiratory_abnormal | SMALLINT | | ⑬呼吸音異常 | 0〜1 |
| remarks | TEXT | | 備考・自由記述 | |
| created_at | TIMESTAMP_NTZ | NOT NULL | 登録日時 | |
| created_by | VARCHAR(100) | NOT NULL | 登録者（監査証跡用） | |

**ユニーク制約**: `(score_sheet_id, observed_at)` — 同一個体・同一日時の重複防止

---

## スコアリング基準（参考）

PDFの凡例に基づく各項目のスコア定義。

### ②食欲

| スコア | 定義 |
|--------|------|
| 0 | 正常 |
| +/- | 残餌1/3以下 |
| 1 | 残餌1/2未満 |
| 2 | 残餌1/2以上 |
| 3 | — |

### ③元気

| スコア | 定義 |
|--------|------|
| 0 | 正常 |
| +/- | やや元気なし |
| 1 | 元気消失 |
| 2 | 起立不能 |
| 3 | 死亡 |

### ④脱水

| スコア | 定義 |
|--------|------|
| 0 | 正常 |
| +/- | 皮膚弾力の若干減退 CRT± |
| 1 | 脱水あり |
| 2 | 眼球の陥没 |
| 3 | 口腔と四肢の冷感・起立不能 |

### ⑤嘔吐

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 吐出 |
| 1 | 嘔吐 |

### ⑥糞便

| スコア | 定義 |
|--------|------|
| 0 | 正常 |
| +/- | 軟便 |
| 1 | 下痢 |
| 2 | 粘液便 |
| 3 | 水様便 |
| 4 | 血便 |

### ⑦鼻汁（左右別）

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 軽度漿液性鼻汁 |
| 1 | 滴る漿液性鼻汁 |
| 3 | 漿液膿性鼻汁 |
| 5 | 膿性鼻汁 |

### ⑧流涙（左右別）

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 軽度流涙 |
| 1 | 流涙 |

### ⑨眼脂（左右別）

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 乾燥した少量の眼脂 |
| 1 | 漿液繊維性 |
| 2 | 膿性 |

### ⑩結膜炎（左右別）

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 結膜の軽度充血（10%程度） |
| 1 | 結膜の一部充血（軽度〜中等度; 10〜50%） |
| 2 | 結膜の大部分充血（重度; 50%〜） |

### ⑪発咳

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 観察中に1回程度 |
| 1 | あり（3分間に1回以上） |
| 2 | 頻発（30秒間に1回以上） |

### ⑫くしゃみ

| スコア | 定義 |
|--------|------|
| 0 | なし |
| +/- | 観察中に1回程度 |
| 1 | あり（3分間に1回以上） |
| 2 | 頻発（30秒間に1回以上） |

### ⑬呼吸音異常

| スコア | 定義 |
|--------|------|
| 0 | なし |
| 1 | あり |

---

## Snowflake DDL

```sql
-- ============================================================
-- 共立製薬 スコアシートデータ基盤
-- Snowflake DDL
-- ============================================================

CREATE SCHEMA IF NOT EXISTS SCORE_SHEET;

-- ------------------------------------------------------------
-- 試験マスター
-- ------------------------------------------------------------
CREATE TABLE SCORE_SHEET.STUDY (
    study_id                VARCHAR(36)     NOT NULL,
    study_name              VARCHAR(200)    NOT NULL,
    study_description       TEXT,
    study_period_start      DATE            NOT NULL,
    study_period_end        DATE,
    administered_substance  VARCHAR(500),
    expected_symptoms       TEXT,
    created_at              TIMESTAMP_NTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP(),
    updated_at              TIMESTAMP_NTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP(),

    CONSTRAINT pk_study PRIMARY KEY (study_id)
);

-- ------------------------------------------------------------
-- スコアシート（試験 × 個体）
-- ------------------------------------------------------------
CREATE TABLE SCORE_SHEET.SCORE_SHEET (
    score_sheet_id          VARCHAR(36)     NOT NULL,
    study_id                VARCHAR(36)     NOT NULL,
    animal_id               VARCHAR(50)     NOT NULL,
    administered_substance  VARCHAR(500),
    expected_symptoms       TEXT,
    laboratory_name         VARCHAR(200),
    created_at              TIMESTAMP_NTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP(),
    updated_at              TIMESTAMP_NTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP(),

    CONSTRAINT pk_score_sheet PRIMARY KEY (score_sheet_id),
    CONSTRAINT fk_score_sheet_study FOREIGN KEY (study_id) REFERENCES SCORE_SHEET.STUDY(study_id),
    CONSTRAINT uq_study_animal UNIQUE (study_id, animal_id)
);

-- ------------------------------------------------------------
-- 観察記録（スコアシート1行 = 1レコード）
-- ------------------------------------------------------------
CREATE TABLE SCORE_SHEET.OBSERVATION (
    observation_id          VARCHAR(36)     NOT NULL,
    score_sheet_id          VARCHAR(36)     NOT NULL,
    observed_at             TIMESTAMP_NTZ   NOT NULL,
    observer_name           VARCHAR(100)    NOT NULL,

    -- 数値測定
    rectal_temperature      DECIMAL(4,1),           -- ①直腸温 [℃]
    body_weight             DECIMAL(5,2),           -- 体重 [kg]

    -- 臨床観察スコア（数値: 0〜各項目の最大値）
    appetite                SMALLINT,               -- ②食欲       (0〜3)
    energy                  SMALLINT,               -- ③元気       (0〜3)
    dehydration             SMALLINT,               -- ④脱水       (0〜3)
    vomiting                SMALLINT,               -- ⑤嘔吐       (0〜1)
    feces                   SMALLINT,               -- ⑥糞便       (0〜4)
    nasal_discharge_l       SMALLINT,               -- ⑦鼻汁（左） (0〜5)
    nasal_discharge_r       SMALLINT,               -- ⑦鼻汁（右） (0〜5)
    lacrimation_l           SMALLINT,               -- ⑧流涙（左） (0〜2)
    lacrimation_r           SMALLINT,               -- ⑧流涙（右） (0〜2)
    eye_discharge_l         SMALLINT,               -- ⑨眼脂（左） (0〜2)
    eye_discharge_r         SMALLINT,               -- ⑨眼脂（右） (0〜2)
    conjunctivitis_l        SMALLINT,               -- ⑩結膜炎（左）(0〜3)
    conjunctivitis_r        SMALLINT,               -- ⑩結膜炎（右）(0〜3)
    coughing                SMALLINT,               -- ⑪発咳       (0〜2)
    sneezing                SMALLINT,               -- ⑫くしゃみ   (0〜2)
    respiratory_abnormal    SMALLINT,               -- ⑬呼吸音異常 (0〜1)

    -- 備考
    remarks                 TEXT,

    -- 監査証跡
    created_at              TIMESTAMP_NTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP(),
    created_by              VARCHAR(100)    NOT NULL,

    CONSTRAINT pk_observation PRIMARY KEY (observation_id),
    CONSTRAINT fk_observation_sheet FOREIGN KEY (score_sheet_id) REFERENCES SCORE_SHEET.SCORE_SHEET(score_sheet_id),
    CONSTRAINT uq_sheet_observed UNIQUE (score_sheet_id, observed_at)
);

-- ------------------------------------------------------------
-- 便利ビュー: 試験・個体・観察を結合したフラットビュー
-- （分析クエリの起点として使用）
-- ------------------------------------------------------------
CREATE VIEW SCORE_SHEET.V_OBSERVATION_DETAIL AS
SELECT
    s.study_id,
    s.study_name,
    s.study_period_start,
    s.study_period_end,
    ss.score_sheet_id,
    ss.animal_id,
    ss.administered_substance,
    ss.expected_symptoms,
    ss.laboratory_name,
    o.observation_id,
    o.observed_at,
    o.observer_name,
    o.rectal_temperature,
    o.body_weight,
    o.appetite,
    o.energy,
    o.dehydration,
    o.vomiting,
    o.feces,
    o.nasal_discharge_l,
    o.nasal_discharge_r,
    o.lacrimation_l,
    o.lacrimation_r,
    o.eye_discharge_l,
    o.eye_discharge_r,
    o.conjunctivitis_l,
    o.conjunctivitis_r,
    o.coughing,
    o.sneezing,
    o.respiratory_abnormal,
    o.remarks,
    -- 左右の最大値（分析用）
    GREATEST(COALESCE(o.nasal_discharge_l, 0), COALESCE(o.nasal_discharge_r, 0)) AS nasal_discharge_max,
    GREATEST(COALESCE(o.lacrimation_l, 0), COALESCE(o.lacrimation_r, 0))         AS lacrimation_max,
    GREATEST(COALESCE(o.eye_discharge_l, 0), COALESCE(o.eye_discharge_r, 0))     AS eye_discharge_max,
    GREATEST(COALESCE(o.conjunctivitis_l, 0), COALESCE(o.conjunctivitis_r, 0))   AS conjunctivitis_max,
    -- 臨床スコア合計（簡易重症度指標）
    COALESCE(o.appetite, 0)
    + COALESCE(o.energy, 0)
    + COALESCE(o.dehydration, 0)
    + COALESCE(o.vomiting, 0)
    + COALESCE(o.feces, 0)
    + GREATEST(COALESCE(o.nasal_discharge_l, 0), COALESCE(o.nasal_discharge_r, 0))
    + GREATEST(COALESCE(o.lacrimation_l, 0), COALESCE(o.lacrimation_r, 0))
    + GREATEST(COALESCE(o.eye_discharge_l, 0), COALESCE(o.eye_discharge_r, 0))
    + GREATEST(COALESCE(o.conjunctivitis_l, 0), COALESCE(o.conjunctivitis_r, 0))
    + COALESCE(o.coughing, 0)
    + COALESCE(o.sneezing, 0)
    + COALESCE(o.respiratory_abnormal, 0)                                         AS total_clinical_score
FROM SCORE_SHEET.STUDY s
JOIN SCORE_SHEET.SCORE_SHEET ss ON s.study_id = ss.study_id
JOIN SCORE_SHEET.OBSERVATION o  ON ss.score_sheet_id = o.score_sheet_id;
```

---

## 設計判断のメモ

### +/- スコアの扱い

PDFの凡例には「+/-（臨床症状未満）」というスコアがある。データベース上の扱いとして以下の選択肢がある:

| 方式 | 説明 | メリット | デメリット |
|------|------|---------|-----------|
| **A: 整数にマッピング** | +/- を特定の整数値（例: -1 or 0）に変換 | SQLでの集計・比較が容易 | 元の表記が失われる |
| **B: VARCHAR型** | 全スコアを文字列で保持 | 元の表記を完全保持 | 集計時にCAST必要 |
| **C: 2カラム方式** | score_raw (VARCHAR) + score_numeric (SMALLINT) | 両方保持 | カラム数が増える |

**推奨: A方式** — +/- を 0 として扱い、現行の「0（正常）」を明示的に記録しない運用とする。または +/- = -1 として区別する。

→ **先方と運用ルールを確認して決定が必要**

### 投与物質の二重管理

`administered_substance` が study と score_sheet の両方にある理由:

- **study レベル**: 試験全体で使用する投与物質の概要（例:「犬5種混合ワクチン A社製 vs B社製」）
- **score_sheet レベル**: その個体に実際に投与した物質（例:「A社製 Lot.2024-A3」または「プラセボ」）

対照群と投与群で異なる物質を投与するため、個体レベルでの記録が必要。

### 左右別データの分析

⑦⑧⑨⑩は左右別に記録されるが、Cross-study比較では左右の**最大値**で集計するケースが多い。`V_OBSERVATION_DETAIL` ビューに `nasal_discharge_max` 等の導出カラムを用意済み。

---

## 関連資料

- [[2026-02-データ基盤メリット提案-共立製薬]] - データ基盤の提案全体像
- [[2026-02-提案整理-共立製薬-スコアシートDX]] - 提案1+2の全体構成
