---
title: システム仕様書 - 東京都農業高校向け補助金支給システム（フルスクラッチ開発）
tags: [nttdx, tokyo, spec, agriculture, scratch-dev]
created: 2026-02-14
project: 東京都農業高校-資格補助案件
status: draft
---

# システム仕様書
## 東京都農業高校向け 補助金支給事務Webシステム

**バージョン**: 1.0（ドラフト）
**作成日**: 2026年2月14日
**関連**: [[外部委託依頼書-フルスクラッチ開発]]

---

## 1. システム概要

### 1-1. 目的

東京都の農業高校に通う高校生が資格を取得する際の補助金について、申請から支給までの一連の事務処理をWeb上で完結させるシステムを構築する。

### 1-2. 利用者

| 利用者 | 想定人数 | 利用頻度 |
|--------|----------|----------|
| 高校生・保護者 | 数百〜数千名/年度 | 年数回（申請時） |
| 事務局（ネクシアBPO） | 5〜10名 | 日常的 |
| 管理者（DXPN/東京都） | 2〜3名 | 週次〜月次 |

### 1-3. 業務フロー

```
【高校生・保護者】                        【事務局（管理者）】

  アカウント登録
       │
  ① 補助金交付申請 ──────────→ 申請レビュー（承認/否認/差し戻し）
       │                              │
  （変更があれば）                      │
  ② 情報変更申請 ──────────→ 変更レビュー（承認/否認）
       │                              │
  （資格受験後）                        │
  ③ 実績報告・証憑提出 ────────→ 実績レビュー → 額の決定
       │                              │
  （額の決定通知受領後）                │
  ④ 支払申請 ──────────────→ 支払レビュー → 振込データ出力
       │
  ステータス確認（随時）
```

---

## 2. 画面一覧・画面仕様

### 2-1. ユーザー側画面

#### SCR-U01: ログイン / アカウント登録

| 項目 | 内容 |
|------|------|
| 概要 | メールアドレス+パスワードでの認証、新規登録、パスワードリセット |
| 入力項目 | メールアドレス、パスワード |
| 登録時の追加項目 | 氏名（漢字・カナ）、生年月日、在籍校、学年、電話番号 |
| バリデーション | メール形式チェック、パスワード強度（8文字以上、英数記号混在）|
| 備考 | メールアドレス認証（確認メール送信） |

#### SCR-U02: マイページ（ダッシュボード）

| 項目 | 内容 |
|------|------|
| 概要 | ログイン後のトップ画面。申請状況の一覧と各種申請への導線 |
| 表示内容 | 申請一覧（種別・ステータス・提出日・更新日）、お知らせ・通知 |
| アクション | 新規申請作成、既存申請の詳細表示、プロフィール編集 |

#### SCR-U03: 補助金交付申請フォーム

| 項目 | 内容 |
|------|------|
| 概要 | 補助金交付申請の入力・提出画面 |
| 入力項目 | 受験予定資格名、受験予定日、受験料金額、受験会場 |
| アップロード | 学生証の画像（JPEG/PNG、10MB以下） |
| バリデーション | 必須項目チェック、金額の数値チェック、ファイル形式・サイズチェック |
| 遷移 | 入力 → 確認 → 提出完了 の3ステップ |

#### SCR-U04: 情報変更申請フォーム

| 項目 | 内容 |
|------|------|
| 概要 | 住所・口座情報等の変更申請 |
| 入力項目 | 変更対象（選択）、変更後の情報、変更理由 |
| アップロード | 変更を証明する書類（任意） |

#### SCR-U05: 実績報告フォーム

| 項目 | 内容 |
|------|------|
| 概要 | 資格受験後の実績報告・証明書類の提出 |
| 入力項目 | 受験日、合否、受験料（実費）、備考 |
| アップロード | 合格証明書、受験料領収書（各JPEG/PNG/PDF、10MB以下） |
| バリデーション | 交付申請との紐付け確認、金額の数値チェック |

#### SCR-U06: 支払申請フォーム

| 項目 | 内容 |
|------|------|
| 概要 | 額の決定通知後の支払申請 |
| 入力項目 | 振込先銀行名、支店名、口座種別、口座番号、口座名義 |
| アップロード | 口座確認書類（通帳コピー等） |
| 前提 | 額の決定済みの実績報告が存在すること |

#### SCR-U07: 申請詳細・履歴

| 項目 | 内容 |
|------|------|
| 概要 | 各申請の詳細表示・ステータス履歴・事務局からのコメント確認 |
| 表示内容 | 申請内容、提出書類のプレビュー、ステータス遷移履歴、差し戻しコメント |
| アクション | 差し戻し時の再提出 |

---

### 2-2. 管理者側画面

#### SCR-A01: 管理者ダッシュボード

| 項目 | 内容 |
|------|------|
| 概要 | 申請状況のサマリー表示 |
| 表示内容 | ステータス別の申請件数、未処理件数、直近の申請一覧 |

#### SCR-A02: 申請一覧・検索

| 項目 | 内容 |
|------|------|
| 概要 | 全申請の一覧表示、フィルタリング、検索 |
| フィルタ条件 | 申請種別、ステータス、在籍校、申請日範囲、氏名 |
| ソート | 申請日、更新日、氏名、ステータス |
| アクション | 詳細表示への遷移、CSV/Excel出力 |
| ページネーション | 1ページあたり20〜50件（設定可能） |

#### SCR-A03: 申請詳細・レビュー

| 項目 | 内容 |
|------|------|
| 概要 | 個別申請の詳細確認とレビュー操作 |
| 表示内容 | 申請者情報、申請内容、提出書類のプレビュー/ダウンロード |
| アクション | 承認、否認、差し戻し（コメント付き） |
| 備考 | 差し戻し時はコメント入力必須 |

#### SCR-A04: ユーザー管理

| 項目 | 内容 |
|------|------|
| 概要 | 登録ユーザーの一覧・詳細・検索 |
| 表示内容 | 氏名、在籍校、学年、登録日、申請件数 |
| アクション | 詳細表示、アカウント無効化 |

#### SCR-A05: データ出力

| 項目 | 内容 |
|------|------|
| 概要 | 申請データの一括出力 |
| 出力形式 | CSV、Excel |
| 出力内容 | 申請一覧、支払データ（振込用）、統計レポート |
| フィルタ | 期間、申請種別、ステータス |

---

### 2-3. 画面一覧サマリー

| ID | 画面名 | 利用者 |
|----|--------|--------|
| SCR-U01 | ログイン / アカウント登録 | ユーザー |
| SCR-U02 | マイページ（ダッシュボード） | ユーザー |
| SCR-U03 | 補助金交付申請フォーム | ユーザー |
| SCR-U04 | 情報変更申請フォーム | ユーザー |
| SCR-U05 | 実績報告フォーム | ユーザー |
| SCR-U06 | 支払申請フォーム | ユーザー |
| SCR-U07 | 申請詳細・履歴 | ユーザー |
| SCR-A01 | 管理者ダッシュボード | 管理者 |
| SCR-A02 | 申請一覧・検索 | 管理者 |
| SCR-A03 | 申請詳細・レビュー | 管理者 |
| SCR-A04 | ユーザー管理 | 管理者 |
| SCR-A05 | データ出力 | 管理者 |

合計: ユーザー側 7画面 + 管理者側 5画面 = **12画面**

---

## 3. データベース設計

### 3-1. ER図（概要）

```
users ─────┬──→ applications ──→ application_reviews
            │         │
            │         ├──→ application_documents
            │         │
            │         └──→ application_status_history
            │
            └──→ notifications
```

### 3-2. テーブル定義

#### users（ユーザー）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | ユーザーID |
| cognito_sub | VARCHAR(255) | UNIQUE, NOT NULL | Cognito ユーザーID |
| email | VARCHAR(255) | UNIQUE, NOT NULL | メールアドレス |
| last_name | VARCHAR(100) | NOT NULL | 姓 |
| first_name | VARCHAR(100) | NOT NULL | 名 |
| last_name_kana | VARCHAR(100) | NOT NULL | 姓（カナ） |
| first_name_kana | VARCHAR(100) | NOT NULL | 名（カナ） |
| birth_date | DATE | NOT NULL | 生年月日 |
| school_name | VARCHAR(200) | NOT NULL | 在籍校名 |
| grade | SMALLINT | NOT NULL | 学年（1-3） |
| phone | VARCHAR(20) | | 電話番号 |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'student' | 権限（student / admin） |
| is_active | BOOLEAN | NOT NULL, DEFAULT true | アカウント有効フラグ |
| created_at | TIMESTAMP | NOT NULL | 登録日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### applications（申請）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | 申請ID |
| user_id | UUID | FK → users.id, NOT NULL | 申請者 |
| type | VARCHAR(50) | NOT NULL | 申請種別（grant / change / report / payment） |
| status | VARCHAR(50) | NOT NULL, DEFAULT 'draft' | ステータス |
| parent_application_id | UUID | FK → applications.id | 親申請（実績報告→交付申請の紐付け等） |
| data | JSONB | NOT NULL | 申請データ（種別ごとに構造が異なる） |
| submitted_at | TIMESTAMP | | 提出日時 |
| decided_amount | INTEGER | | 決定額（円）※実績報告の審査後に設定 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

**申請ステータス遷移**:

```
draft → submitted → under_review → approved / rejected / remanded
                                          │
                                   (実績報告の場合)
                                   approved → amount_decided
```

**申請種別ごとの data カラム構造（例）**:

```json
// grant（補助金交付申請）
{
  "qualification_name": "日商簿記検定2級",
  "exam_date": "2026-07-15",
  "exam_fee": 4720,
  "exam_venue": "東京商工会議所"
}

// report（実績報告）
{
  "exam_date": "2026-07-15",
  "result": "pass",
  "actual_fee": 4720,
  "remarks": ""
}

// payment（支払申請）
{
  "bank_name": "三菱UFJ銀行",
  "branch_name": "新宿支店",
  "account_type": "普通",
  "account_number": "1234567",
  "account_holder": "ヤマダ タロウ"
}
```

#### application_documents（申請書類）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | 書類ID |
| application_id | UUID | FK → applications.id, NOT NULL | 申請ID |
| document_type | VARCHAR(50) | NOT NULL | 書類種別（student_id / certificate / receipt / bank_book） |
| file_name | VARCHAR(500) | NOT NULL | 元ファイル名 |
| file_path | VARCHAR(1000) | NOT NULL | S3上のパス |
| file_size | INTEGER | NOT NULL | ファイルサイズ（bytes） |
| mime_type | VARCHAR(100) | NOT NULL | MIMEタイプ |
| created_at | TIMESTAMP | NOT NULL | アップロード日時 |

#### application_reviews（レビュー）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | レビューID |
| application_id | UUID | FK → applications.id, NOT NULL | 申請ID |
| reviewer_id | UUID | FK → users.id, NOT NULL | レビュアー（管理者） |
| action | VARCHAR(20) | NOT NULL | アクション（approve / reject / remand） |
| comment | TEXT | | コメント（差し戻し時は必須） |
| decided_amount | INTEGER | | 決定額（実績報告の承認時） |
| created_at | TIMESTAMP | NOT NULL | レビュー日時 |

#### application_status_history（ステータス履歴）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | 履歴ID |
| application_id | UUID | FK → applications.id, NOT NULL | 申請ID |
| from_status | VARCHAR(50) | | 変更前ステータス |
| to_status | VARCHAR(50) | NOT NULL | 変更後ステータス |
| changed_by | UUID | FK → users.id | 変更者 |
| created_at | TIMESTAMP | NOT NULL | 変更日時 |

#### notifications（通知）

| カラム | 型 | 制約 | 説明 |
|--------|------|------|------|
| id | UUID | PK | 通知ID |
| user_id | UUID | FK → users.id, NOT NULL | 通知先ユーザー |
| type | VARCHAR(50) | NOT NULL | 通知種別 |
| title | VARCHAR(200) | NOT NULL | タイトル |
| body | TEXT | NOT NULL | 本文 |
| is_read | BOOLEAN | NOT NULL, DEFAULT false | 既読フラグ |
| created_at | TIMESTAMP | NOT NULL | 送信日時 |

---

## 4. API設計

### 4-1. API一覧

ベースURL: `https://api.example.com/v1`

#### 認証

| Method | Endpoint | 説明 |
|--------|----------|------|
| POST | /auth/signup | アカウント登録 |
| POST | /auth/confirm | メールアドレス確認 |
| POST | /auth/login | ログイン |
| POST | /auth/logout | ログアウト |
| POST | /auth/forgot-password | パスワードリセット要求 |
| POST | /auth/reset-password | パスワードリセット実行 |

#### ユーザー

| Method | Endpoint | 説明 | 権限 |
|--------|----------|------|------|
| GET | /users/me | 自分のプロフィール取得 | student, admin |
| PUT | /users/me | プロフィール更新 | student, admin |
| GET | /users | ユーザー一覧（検索・ページネーション） | admin |
| GET | /users/:id | ユーザー詳細 | admin |
| PATCH | /users/:id/deactivate | アカウント無効化 | admin |

#### 申請

| Method | Endpoint | 説明 | 権限 |
|--------|----------|------|------|
| POST | /applications | 申請作成（下書き） | student |
| GET | /applications | 自分の申請一覧 | student |
| GET | /applications/:id | 申請詳細 | student（自分のみ）, admin |
| PUT | /applications/:id | 申請更新（下書き・差し戻し時） | student |
| POST | /applications/:id/submit | 申請提出 | student |
| GET | /admin/applications | 全申請一覧（フィルタ・検索・ページネーション） | admin |
| GET | /admin/applications/export | 申請データCSV/Excel出力 | admin |

#### レビュー

| Method | Endpoint | 説明 | 権限 |
|--------|----------|------|------|
| POST | /applications/:id/review | レビュー（承認/否認/差し戻し） | admin |
| GET | /applications/:id/reviews | レビュー履歴 | admin |

#### 書類

| Method | Endpoint | 説明 | 権限 |
|--------|----------|------|------|
| POST | /applications/:id/documents | 書類アップロード | student |
| GET | /applications/:id/documents | 書類一覧 | student（自分のみ）, admin |
| GET | /documents/:id/download | 書類ダウンロード | student（自分のみ）, admin |
| DELETE | /documents/:id | 書類削除（下書き時のみ） | student |

#### 通知

| Method | Endpoint | 説明 | 権限 |
|--------|----------|------|------|
| GET | /notifications | 通知一覧 | student, admin |
| PATCH | /notifications/:id/read | 既読にする | student, admin |

### 4-2. 共通仕様

#### リクエストヘッダー

```
Authorization: Bearer <JWT Token>
Content-Type: application/json
```

#### ページネーション

```json
// リクエスト
GET /admin/applications?page=1&per_page=20&status=submitted&sort=created_at&order=desc

// レスポンス
{
  "data": [...],
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 150,
    "total_pages": 8
  }
}
```

#### エラーレスポンス

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力内容にエラーがあります",
    "details": [
      { "field": "exam_fee", "message": "金額は正の整数で入力してください" }
    ]
  }
}
```

---

## 5. インフラ構成

### 5-1. 構成図

```
                    ┌─────────────┐
                    │  Route 53   │
                    │  (DNS)      │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │ CloudFront  │
                    │  (CDN)      │
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              │                         │
       ┌──────▼──────┐          ┌──────▼──────┐
       │   S3        │          │   ALB       │
       │ (静的資産)   │          │             │
       └─────────────┘          └──────┬──────┘
                                       │
                                ┌──────▼──────┐
                                │   ECS       │
                                │ (Fargate)   │
                                │  Next.js    │
                                │  Express    │
                                └──────┬──────┘
                                       │
                          ┌────────────┼────────────┐
                          │            │            │
                   ┌──────▼──┐  ┌─────▼────┐  ┌───▼────────┐
                   │   RDS   │  │ Cognito  │  │    S3      │
                   │ Postgres│  │ (認証)   │  │ (書類保存) │
                   └─────────┘  └──────────┘  └────────────┘
```

### 5-2. AWS リソース

| サービス | 用途 | 想定スペック |
|----------|------|------------|
| ECS (Fargate) | アプリケーション実行 | vCPU 0.5, Memory 1GB x 2タスク |
| RDS (PostgreSQL) | データベース | db.t3.small, Multi-AZ |
| S3 | 静的資産 + 書類保存 | 標準ストレージ |
| CloudFront | CDN + HTTPS終端 | - |
| Route 53 | DNS | - |
| Cognito | ユーザー認証 | ユーザープール |
| SES | メール通知 | - |
| CloudWatch | 監視・ログ | ログ保持90日 |

### 5-3. 環境構成

| 環境 | 用途 | URL（例） |
|------|------|-----------|
| 開発 | 開発・デバッグ用 | dev.example.com |
| ステージング | 受入テスト用 | stg.example.com |
| 本番 | 本番運用 | www.example.com |

---

## 6. セキュリティ要件

| 項目 | 対応内容 |
|------|----------|
| 通信暗号化 | 全通信HTTPS（TLS 1.2以上） |
| 認証 | AWS Cognito（JWT）、パスワードポリシー（8文字以上、英数記号混在） |
| 認可 | ロールベースアクセス制御（student / admin） |
| CSRF対策 | CSRFトークン |
| XSS対策 | 入力サニタイズ、Content-Security-Policy |
| SQLインジェクション | Prisma ORM（パラメータバインディング） |
| ファイルアップロード | MIMEタイプ検証、ファイルサイズ制限、S3直接アップロード（署名付きURL） |
| 個人情報保護 | RDSの暗号化、S3の暗号化（SSE-S3）、アクセスログ |
| 監査ログ | ログイン・申請操作・レビュー操作の記録 |

---

## 7. メール通知一覧

| トリガー | 送信先 | 件名（例） |
|----------|--------|------------|
| アカウント登録 | ユーザー | 【農業高校補助金】アカウント登録確認 |
| 申請提出 | ユーザー | 【農業高校補助金】申請を受け付けました |
| 申請承認 | ユーザー | 【農業高校補助金】申請が承認されました |
| 申請否認 | ユーザー | 【農業高校補助金】申請結果のお知らせ |
| 申請差し戻し | ユーザー | 【農業高校補助金】申請内容の修正をお願いします |
| 額の決定 | ユーザー | 【農業高校補助金】補助金額が決定しました |
| 新規申請受付 | 管理者 | 【管理】新しい申請が提出されました |

---

## 8. 対象外・今後の拡張候補

以下は本開発のスコープ外とし、将来的な拡張候補とする。

| 項目 | 理由 |
|------|------|
| AI機能（チャットボット、OCR） | 別予算・別フェーズで検討 |
| ネイティブアプリ | レスポンシブWebで対応 |
| 多言語対応 | 現時点で要件なし |
| SSO連携（学校のAD等） | 既存システムにもない機能 |
| 分析ダッシュボード | 初期リリース後に検討 |

---

## 付録A: 用語集

| 用語 | 説明 |
|------|------|
| 補助金交付申請 | 資格受験前に行う補助金の事前申請 |
| 実績報告 | 資格受験後に合否・費用を報告すること |
| 額の決定 | 事務局が実績報告を審査し、補助金額を確定すること |
| 支払申請 | 額の決定後、振込先を指定して支給を受けるための申請 |
| 差し戻し | 申請内容に不備があり、修正を求めること |
| BPO | Business Process Outsourcing（業務プロセスの外部委託） |

---

**以上**
